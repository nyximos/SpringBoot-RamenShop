<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>edit</title>
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"
		integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
</head>

<body>
	<h2>메뉴조회</h2>

	<table border="1">
		<thead>
			<tr>
				<td>메뉴명</td>
				<td>가격</td>
				<td>설명</td>
				<td>카테고리</td>
				<td></td>
				<td></td>
		</thead>
		<tbody>
			<tr th:each="m : ${menus}">
				<td th:text="${m.name}"></td>
				<td th:text="${m.price}"></td>
				<td th:text="${m.description}"></td>
				<td th:text="${m.menuGroup.name}"></td>
				<td><button>수정</button></td>
				<td><button id="del" th:class="${m.id}">삭제</button></td>
			</tr>
		</tbody>
	</table>

	<h2>메뉴추가</h2>

	<input id="name" type="text" placeholder="메뉴명"><br>
	<input id="price" type="text" placeholder="가격"><br>
	<input id="image" type="text" placeholder="이미지경로"><br>
	<input id="description" type="text" placeholder="메뉴설명"><br>	
	<select id="status" placeholder="판매여부"><br>
		<option value="0">yes</option>
		<option value="1">no</option>
	</select>	
	<select id="menuGroupId">
		<span th:each="mg : ${menugroups}">
			<option th:text="${mg.name}" th:value="${mg.id}"></option>
		</span>
	</select><br><br>
	<button id="reg">등록</button><br>
	<br>
	
	<h2>메뉴수정</h2>
	
	<select id="name">
		<span th:each="m : ${menus}">
			<option th:text="${m.name}" th:value="${m.name}">밥</option>
		</span>
	</select>	
	<br>	
	<input id="price" type="text" placeholder="가격"><br>
	<input id="image" type="text" placeholder="이미지경로"><br>
	<input id="description" type="text" placeholder="메뉴설명"><br>	
	<select id="status" placeholder="판매여부"><br>
		<option value="0">yes</option>
		<option value="1">no</option>
	</select><br><br>	
	<button id="mod">수정</button>


	<script th:inline="javascript">
		$(function () {
			$('#reg').click((event) => {
				const name = $('#name').val();
				const price = $('#price').val();
				const imgUrl = $('#image').val();
				const description = $('#description').val();
				const isSale = $('#status').val();
				const menuGroup = {
					'id': $('#menuGroupId').val(),

				}
				if (name == '' || price == '' || imgUrl == '' || description == '') {
					alert('입력해주세요');
					return;
				}

				const path = '/api/admin/edit';
				const json = JSON.stringify({
					'name': name,
					'price': price,
					'imgUrl': imgUrl,
					'description': description,
					'isSale': isSale,
					'menuGroup': menuGroup
				});
				const csrfToken =/*[[${_csrf.token}]]*/ null;
				const csrfHeader =/*[[${_csrf.headerName}]]*/ null;
				$.ajax({
					url: path,
					type: 'POST',
					contentType: 'application/json',
					data: json,
					beforeSend: function (xhr) {xhr.setRequestHeader(csrfHeader, csrfToken);}
				}).done((result) => {
					console.log(result);
					if (result.result == "ok") {
						alert("등록 성공")
						window.location.reload();
					} else alert("등록 실패. 이미 있는 아이디입니다")
				});
			});
			$('#del').click((event) => {
                alert($(this).attr('class'));
				const name = $('#name').val();
				alert(test)
				if (name == '' || price == '' || imgUrl == '' || description == '') {
					alert('입력해주세요');
					return;
				}

				const path = '/api/admin/edit';
				const json = JSON.stringify({
					'name': name
				});
				const csrfToken =/*[[${_csrf.token}]]*/ null;
				const csrfHeader =/*[[${_csrf.headerName}]]*/ null;
				$.ajax({
					url: path,
					type: 'DELETE',
					contentType: 'application/json',
					data: json,
					beforeSend: function (xhr) {xhr.setRequestHeader(csrfHeader, csrfToken);}
				}).done((result) => {
					console.log(result);
					if (result.result == "ok") {
						alert("등록 성공")
						window.location.reload();
					} else alert("등록 실패. 이미 있는 아이디입니다")
				});
			});
		});
	</script>
</body>

</html>